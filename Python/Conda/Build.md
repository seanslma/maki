# Build 

https://docs.conda.io/projects/conda-build/en/latest/concepts/recipe.html

Building a conda package requires a recipe. A conda-build recipe is a flat directory that contains the following files:
- meta.yaml: Only `package/name` and `package/version` are required
- build.sh: It is executed using the bash command for macOS and Linux.
- bld.bat: It is executed using cmd for Windows.
- run_test.[py,pl,sh,bat]: a test script that runs automatically if it is part of the recipe.
- Optional patches that are applied to the source.
- Other resources that are not included in the source and cannot be generated by the build scripts.

## build conda package
```
conda build recipe --no-anaconda-upload --python 3.9 --croot c:/pkg/conda --output --no-test
conda build recipe --no-anaconda-upload --python 3.9 --croot /build/path --output --no-test --channel ch1 --channel ch2
```

## install `conda-build`, not used???
```
conda install conda-build
conda update conda-build
```

## meta.yaml
https://stackoverflow.com/questions/38919840/get-package-version-for-conda-meta-yaml-from-source-file
```
{% set NAME = "pkg" %}
{% set VERSION = load_setup_py_data().version %}
{% set GITHUB_URL = load_setup_py_data().url %}
{% set DESCRIPTION = load_setup_py_data().description %}

package:
  name: {{ NAME }}
  version: {{ VERSION }}

source:
  path: ../

outputs:
  - name: {{ NAME }}
    build:
      number: 0
      script: python -m pip install --no-deps --ignore-installed .
      entry_points:
        - pkg-run = pkg.main:cli
    requirements:
      host:
        - pip
        - python
        - setuptools >=41.0.0
      run:
        - click
        - numba
        - numpy
        - pandas
        - python
    about:
      home: {{ GITHUB_URL }}
      summary: {{ DESCRIPTION }}

  - name: {{ NAME }}.test
    requirements:
      run:
        - pytest
        - pytest-cov
        - coverage
    test:
      source_files:
        - tests
    about:
      home: {{ GITHUB_URL }}
      summary: Test dependencies for {{ NAME }}

  - name: {{ NAME }}.doc
    requirements:
      run:
        - docstring_parser
        - mkdocs
        - mkdocstrings <0.18
        - mkdocs-click
        - mkdocs-material
        - mkdocs-material-extensions
        - pytkdocs
    about:
      home: {{ GITHUB_URL }}
      summary: Doc dependencies for {{ NAME }}
```
